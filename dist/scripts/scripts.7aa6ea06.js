"use strict";angular.module("myTodoAngularApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.date"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/todo-list",{templateUrl:"views/todo.html",controller:"TodoController"}).when("/about",{templateUrl:"views/about.html",controller:"AboutController"}).when("/help",{templateUrl:"views/help.html",controller:"HelpController"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$window",function(a,b,c){a.$on("$routeChangeSuccess",function(){c.ga("send","pageview",{page:b.path()})})}]),angular.module("myTodoAngularApp").controller("MainController",function(){}),angular.module("myTodoAngularApp").controller("AboutController",function(){}),angular.module("myTodoAngularApp").controller("HelpController",function(){}),angular.module("myTodoAngularApp").controller("TodoController",["$scope",function(a){function b(){i&&(localStorage.setItem("myTodos",JSON.stringify(d(a.todos))),localStorage.setItem("myDoneTodos",JSON.stringify(d(a.doneTodos))))}function c(a){for(var b=[],c=0;c<a.categories.length;c++)for(var d=a.categories[c],e=0;e<d.todos.length;e++){var f=d.todos[e];f.category=d.name,b[b.length]=f}return b}function d(a){for(var b=JSON.parse('{ "categories": [] }'),c=[],d=0;d<a.length;d++){var e=a[d],f=e.category;if(-1===$.inArray(f,c)){c[c.length]=f;for(var g=JSON.parse('{ "name": "'+f+'", "todos": [] }'),h=0;h<a.length;h++){var i=a.slice()[h];i.category===f&&(g.todos[g.todos.length]=i)}b.categories[b.categories.length]=g}}return b}function e(a){a.isEditing=!1}function f(){a.newTodoText="",a.newTodoPriority="",$("#newTodoDate").val("")}function g(){for(var b=0,c=0;c<a.todos.length;c++){var d=a.todos[c],e=d.id;e>b&&(b=e)}for(c=0;c<a.doneTodos.length;c++){var f=a.doneTodos[c],g=f.id;g>b&&(b=g)}return b}function h(a,b){var c=864e5,d=a.getTime(),e=b.getTime(),f=e-d;return Math.round(f/c)}a.inputTypeDateSupported=window.Modernizr.inputtypes.date;var i=!1;"undefined"!=typeof Storage&&(i=!0),a.newTodoText="",a.newTodoPriority="",a.todoSortBy="duedate",a.doneTodoSortBy="duedate",a.isEditingTodo=!1,a.showDoneTodos=!1,a.currentCategory="",i&&(null!==localStorage.getItem("myTodos")?(a.categoricalTodos=JSON.parse(localStorage.getItem("myTodos")),a.todos=c(a.categoricalTodos)):(a.categoricalTodos=JSON.parse('{ "categories": [] }'),a.todos=[]),null!==localStorage.getItem("myDoneTodos")?(a.doneCategoricalTodos=JSON.parse(localStorage.getItem("myDoneTodos")),a.doneTodos=c(a.doneCategoricalTodos)):(a.doneCategoricalTodos=JSON.parse('{ "categories": [] }'),a.doneTodos=[])),a.currentMaxId=g(),console.log(a.categoricalTodos),console.log(a.doneCategoricalTodos),console.log(a.currentMaxId),a.newCategory=function(){bootbox.prompt("What's the name of this category?",function(c){if(null!==c){""===c&&noty({type:"error",text:"Category title cannot be empty!",timeout:1e3});var d=c,e=JSON.parse('{ "name": "'+d+'", "todos": [] }');a.categoricalTodos.categories[a.categoricalTodos.categories.length]=e,a.currentCategory=d,a.$apply(),$("#categoryTabs li:last").prev().find("a").tab("show"),b()}})},a.addNewTodo=function(){return""===a.newTodoText?void noty({type:"error",text:"Description cannot be blank!",timeout:1e3}):""===a.newTodoPriority?void noty({type:"error",text:"Priority must be set!",timeout:1e3}):""===$("#newTodoDate").val()?void noty({type:"error",text:"Due date must be set!",timeout:1e3}):(a.todos[a.todos.length]={id:++a.currentMaxId,category:a.currentCategory,description:a.newTodoText,duedate:Date.parse($("#newTodoDate").val()).toISOString(),priority:a.newTodoPriority},b(),void f())},a.reAddTodo=function(c){if(c>-1){var d=a.doneTodos.splice(c,1)[0];a.todos[a.todos.length]=d}b()},a.finishTodo=function(c){if(c>-1){var d=a.todos.splice(c,1)[0];a.doneTodos[a.doneTodos.length]=d}b()},a.deleteUnfinishedTodo=function(c){c>-1&&a.todos.splice(c,1),b()},a.deleteTodo=function(c){c>-1&&a.doneTodos.splice(c,1),b()},a.changeCategory=function(b){a.currentCategory=b},a.startEditingTodo=function(a){a.isEditing=!0,a.editDescription=a.todo.description,a.editPriority=a.todo.priority,a.editDueDate=Date.parse(a.todo.duedate)},a.cancelEditingTodo=function(a){e(a)},a.saveEditingTodo=function(a){a.todo.description=a.editDescription,a.todo.priority=a.editPriority;var c=a.editDueDate.toISOString();a.todo.duedate=c,b(),e(a)},a.toggleShowDoneTodos=function(){a.showDoneTodos=!a.showDoneTodos},a.getShowDoneTodosIconClass=function(){return a.showDoneTodos?"glyphicon glyphicon-chevron-up":"glyphicon glyphicon-chevron-down"},a.getDateString=function(b){var c=h(Date.today().at("0:00"),Date.parse(b).at("0:00"));return 0>c?-1===c?"1 day overdue":-c+" days overdue":Date.today().equals(Date.parse(b).at("0:00"))?"Today":Date.parse("tomorrow").equals(Date.parse(b).at("0:00"))?"Tomorrow":a.getFormattedDateString(b)},a.getFormattedDateString=function(a){return Date.parse(a).toString("d MMM 'yy")},a.priorityColorClass=function(a){return a=parseInt(a),1===a?"bg-red":2===a?"bg-green":3===a?"bg-blue":""}}]);